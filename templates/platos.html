{% extends "base.html" %}

{% block title %}Platos{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link rel="shortcut icon" href="{{ url_for('static', filename='img/nutriboom.png') }}" />
<link href="{{ url_for('static', filename='css/platos.css') }}" rel="stylesheet"/>

<div class="center">
    <div class="container mt-4">
        <!-- Header -->
        <div class="table-wrapper">
            <div class="table-title">
                <div class="row">
                    <div class="col-sm-6">
                        <h2>Gestionar <b>platos</b></h2>
                    </div>
                    <div class="col-sm-6 text-end">
                        <a href="#addEmployeeModal" class="btn btn-success" data-bs-toggle="modal">
                            <i class="fa fa-plus"></i> <span>Añadir plato</span>
                        </a>
                    </div>
                </div>
            </div>
    
            <!-- Formulario para eliminar seleccionados -->
            <form action="{{ url_for('delete_platos') }}" method="POST" id="deleteSelectedForm">
                <a href="javascript:void(0);" id="deleteSelectedBtn" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                    <i class="fa fa-trash"></i><span>Eliminar seleccionados</span>
                </a>
    
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>
                                <span class="custom-checkbox">
                                    <input type="checkbox" id="selectAll" onclick="checkAll(this)">
                                    <label for="selectAll"></label>
                                </span>
                            </th>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Ingredientes</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for plato in platos %}
                            <tr>
                                <td>
                                    <span class="custom-checkbox">
                                        <input type="checkbox" name="ids[]" value="{{ plato.id_plato }}" id="checkbox{{ loop.index }}">
                                        <label for="checkbox{{ loop.index }}"></label>
                                    </span>
                                </td>
                                <td>{{ plato.nombre }}</td>
                                <td>{{ plato.tipo }}</td>
                                <td>
                                    {% for ingrediente in plato.ingredientes %}
                                        <span class="badge bg-info">{{ ingrediente.nombre }}</span>
                                    {% endfor %}
                                </td>
                                <td>
                                    <a href="#editEmployeeModal{{ plato.id_plato }}" class="edit" data-bs-toggle="modal">
                                        <i class="fa fa-edit" data-bs-toggle="tooltip" title="Editar"></i>
                                    </a>
                                    
                                    <a href="#deleteEmployeeModal{{ plato.id_plato }}" class="delete" data-bs-toggle="modal">
                                        <i class="fa fa-trash-alt" data-bs-toggle="tooltip" title="Eliminar"></i>
                                    </a>
                                    
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </form>
    
            <!-- Paginación -->
            <div aria-label="Page navigation example">
                <ul class="pagination justify-content-center mt-4">
                    {% if current_page > 1 %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('platos', page=current_page - 1) }}">Anterior</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">Anterior</span></li>
                    {% endif %}
    
                    {% for p in range(1, total_pages + 1) %}
                        <li class="page-item {% if p == current_page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('platos', page=p) }}">{{ p }}</a>
                        </li>
                    {% endfor %}
    
                    {% if current_page < total_pages %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('platos', page=current_page + 1) }}">Siguiente</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    
        <!-- Modal de confirmación de eliminación -->
        <div id="confirmDeleteModal" class="modal fade" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Eliminar Platos Seleccionados</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <p>¿Estás seguro que deseas eliminar los platos seleccionados?</p>
                        <p class="text-warning"><small>Esta acción es irreversible</small></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-danger" id="confirmDeleteBtn">Eliminar</button>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Modal Añadir -->
        <div id="addEmployeeModal" class="modal fade" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="POST" action="{{ url_for('add_plato') }}">
                        <div class="modal-header">
                            <h5 class="modal-title">Añadir plato</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="nombre" class="form-label">Nombre</label>
                                <input type="text" name="nombre" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="tipo" class="form-label">Tipo</label>
                                <select name="tipo" class="form-select" required>
                                    <option value="Desayuno">Desayuno</option>
                                    <option value="Almuerzo">Almuerzo</option>  
                                    <option value="Comida">Comida</option>  
                                    <option value="Merienda">Merienda</option>
                                    <option value="Cena">Cena</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="ingredientes" class="form-label">Ingredientes</label>
                                <select name="ingredientes" class="form-select" multiple required>
                                    {% for ingrediente in ingredientes %}
                                        <option value="{{ ingrediente.id_ingrediente }}">{{ ingrediente.nombre }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-success">Añadir</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    
        <!-- Modales Editar y Eliminar -->
        {% for plato in platos %}
            <!-- Modal Editar -->
            <form action="{{ url_for('update_plato', id_plato=plato.id_plato) }}" method="POST" class="modal fade" id="editEmployeeModal{{ plato.id_plato }}" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Editar Plato</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="id_plato" value="{{ plato.id_plato }}">
                            <div class="mb-3">
                                <label class="form-label">Nombre</label>
                                <input type="text" name="nombre" class="form-control" value="{{ plato.nombre }}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Tipo</label>
                                <select name="tipo" class="form-select" required>
                                    {% for tipo in tipos_plato %}
                                        <option value="{{ tipo }}" {% if plato.tipo == tipo %}selected{% endif %}>{{ tipo }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Ingredientes</label>
                                <select name="ingredientes" class="form-select" multiple required>
                                    {% for ingrediente in ingredientes %}
                                        <option value="{{ ingrediente.id_ingrediente }}"
                                            {% if plato_a_editar %}
                                                {% if ingrediente.id_ingrediente in ingredientes_ids %}selected{% endif %}
                                            {% else %}
                                                {% if ingrediente in plato.ingredientes %}selected{% endif %}
                                            {% endif %}
                                        >
                                            {{ ingrediente.nombre }}
                                        </option>
                                    {% endfor %}
                                </select>
                                
                                
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-info">Guardar</button>
                        </div>
                    </div>
                </div>
            </form>
    
            <!-- Modal Eliminar -->
            <form method="POST" action="{{ url_for('delete_plato', id_plato=plato.id_plato) }}" class="modal fade" id="deleteEmployeeModal{{ plato.id_plato }}" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Eliminar Plato</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                        </div>
                        <div class="modal-body">
                            <p>¿Estás seguro que deseas eliminar el plato?</p>
                            <p class="text-warning"><small>Esta acción es irreversible</small></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-danger">Eliminar</button>
                        </div>
                    </div>
                </div>
            </form>
        {% endfor %}
    
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/select.js') }}"></script>
<script src="{{ url_for('static', filename='js/checkbox_all.js') }}"></script>

{% endblock %}
